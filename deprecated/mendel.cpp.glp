$$ constants {
    const string API_KEY = "TU_API_KEY_AQUI";
    const string MODEL_ID = "gemini-1.5-flash";
    const int MAX_GENERATIONS = 10;
}

$$ABSTRACT network_utils -> {
    size_t WriteCallback(void* contents, size_t size, size_t nmemb, void* userp);
    string callGeminiAPI(string prompt);
}

$$ network_utils_impl -> network_utils {
    1. Define WriteCallback to append data to userp string.
    2. Implement callGeminiAPI:
        2.1 Initialize CURL.
        2.2 Construct API URL.
        2.3 Prepare JSON body.
        2.4 Set CURL options (URL, POST data, headers, write callback).
        2.5 Perform request and handle errors.
        2.6 Clean up resources.
        2.7 Return response buffer.
}

$$ system_utils {
    string execCommand(const char* cmd);
}

$$ language_config {
    struct LanguageConfig {
        string lang;
        string ext;
        string compile_cmd_base;
    };
}

$$ language_detection -> language_config {
    LanguageConfig detectLanguage(json blueprint);
}

$$ language_detection_impl -> language_detection {
    1. Extract tech stack from blueprint.
    2. Convert stack to lowercase.
    3. Check for C++ or Python and return corresponding LanguageConfig.
}

$$ markdown_cleaning {
    string cleanMarkdown(string raw);
}

$$ markdown_cleaning_impl -> markdown_cleaning {
    1. Find markdown code block boundaries.
    2. Extract code content between boundaries.
    3. Return cleaned code or original input if no boundaries found.
}

$$ main_loop -> network_utils, system_utils, language_detection, markdown_cleaning {
    1. Initialize system.
    2. Load blueprint from app.json.
    3. Detect language and set configuration.
    4. Enter evolutionary loop:
        4.1 Construct prompt based on current error state.
        4.2 Call Gemini API for code generation.
        4.3 Parse and clean API response.
        4.4 Save generated code to file.
        4.5 Compile and verify code integrity.
        4.6 Handle compilation results and update error state.
    5. Exit with success or failure status.
}

$$ main -> main_loop {
    1. Call main_loop with necessary parameters.
}
